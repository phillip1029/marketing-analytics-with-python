

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 9 Marketing Media Mix Models &#8212; Marketing Analytics with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter_9';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 10 Next Best Action (NBA) Models" href="chapter_10.html" />
    <link rel="prev" title="Chapter 8 Marketing Channel Attribution Models" href="chapter_8.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Preface
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part I Introduction to Marketing Analytics</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter_1.html">Chapter 1 The Role of Data Science in Marketing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_2.html">Chapter 2 Data Preprocessing and Exploratory Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_3.html">Chapter 3 Feature Engineering for Marketing Data</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part II Predictive Analytics for Marketing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter_4.html">Chapter 4 Regression Analysis for Marketing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_5.html">Chapter 5 Classification Models for Customer Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_6.html">Chapter 6 Time Series Forecasting</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_7.html">Chapter 7 Price Elasticity and Optimizaton</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part III Advanced Marketing Analytics</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter_8.html">Chapter 8 Marketing Channel Attribution Models</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 9 Marketing Media Mix Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_10.html">Chapter 10 Next Best Action (NBA) Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_11.html">Chapter 11 Natural Language Processing for Sentiment Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_12.html">Chapter 12 Recommender Systems for Personalized Marketing</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_13.html">Chapter 13 A/B Testing and Experimentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_14.html">Chapter 14 Customer Lifetime Value Prediction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part IV Case Studies and Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter_15.html">Chapter 15 Churn Prediction and Retention Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_16.html">Chapter 16 Optimizing Marketing Campaigns with Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_17.html">Chapter 17 Social Media Analytics for Marketing Insights</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part V Conclusion</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter_18.html">Chapter 18 Future Trends in Marketing Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter_19.html">Chapter 19 Best Practices and Pitfalls to Avoid</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/phillip1029/marketing-analytics-with-python" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/phillip1029/marketing-analytics-with-python/issues/new?title=Issue%20on%20page%20%2Fchapter_9.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chapter_9.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 9 Marketing Media Mix Models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">9.1 <strong>Introduction</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-importance-of-mmm-in-the-modern-marketing-landscape">9.1.1 The Importance of MMM in the Modern Marketing Landscape</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-objective-of-mmm">9.1.2 The Objective of MMM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basics-of-media-mix-modeling">9.2 <strong>The Basics of Media Mix Modeling</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-media-mix-modeling">9.2.1 What is Media Mix Modeling?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-mmm-in-data-driven-marketing-decisions">9.2.2 The Role of MMM in Data-Driven Marketing Decisions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-components-of-mmm">9.2.3 Key Components of MMM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#brief-history-and-evolution-of-mmm">9.2.4 Brief History and Evolution of MMM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-framework-of-mmm">9.3 <strong>Understanding the Framework of MMM</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#theoretical-foundation-of-mmm">9.3.1 Theoretical Foundation of MMM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-methods-used-in-mmm">9.3.2 Statistical Methods Used in MMM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accounting-for-diminishing-returns-and-synergy">9.3.3 Accounting for Diminishing Returns and Synergy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-media-mix-model-in-python-a-step-by-step-guide">9.4 Building a Media Mix Model in Python: A Step-by-Step Guide</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">9.4.1 Data Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-processing">9.4.2 Data Processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">9.4.3 Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-training">9.4.4 Model Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-for-the-best-model">9.4.5 search for the best model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#media-expenditure-optimization">9.4.6 Media Expenditure Optimization</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-9-marketing-media-mix-models">
<h1>Chapter 9 Marketing Media Mix Models<a class="headerlink" href="#chapter-9-marketing-media-mix-models" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2>9.1 <strong>Introduction</strong><a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>In today’s rapidly evolving marketing landscape, the ability to quantify the impact of each dollar spent across various channels is more crucial than ever. Media Mix Modeling (MMM) stands at the forefront of data-driven marketing strategies, offering a sophisticated analytical approach that dissects the performance of each marketing channel in isolation and in synergy. By employing statistical models that incorporate sales data, marketing expenditures, and external factors, MMM provides a comprehensive overview of marketing performance, allowing marketers to understand the effectiveness of their advertising expenditures.</p>
<p>The essence of MMM lies in its ability to not only retrospectively analyze past performance but also to predict how adjustments in the marketing mix can influence future outcomes. This dual capability makes it an invaluable tool for marketers aiming to optimize their strategies in alignment with business objectives, whether it’s increasing overall sales, enhancing brand awareness, or achieving a higher return on investment (ROI).</p>
<section id="the-importance-of-mmm-in-the-modern-marketing-landscape">
<h3>9.1.1 The Importance of MMM in the Modern Marketing Landscape<a class="headerlink" href="#the-importance-of-mmm-in-the-modern-marketing-landscape" title="Permalink to this heading">#</a></h3>
<p>In an era marked by the proliferation of digital channels and increasingly discerning consumers, MMM offers several advantages. It helps organizations navigate the complexity of the modern marketing ecosystem, where traditional media channels coexist with digital platforms, each offering varying levels of engagement and effectiveness. Moreover, MMM addresses the challenge of attribution, determining which channels are truly driving conversions and to what extent. This enables more effective reallocation of marketing budgets, away from underperforming channels and towards those with a proven impact on sales.</p>
</section>
<section id="the-objective-of-mmm">
<h3>9.1.2 The Objective of MMM<a class="headerlink" href="#the-objective-of-mmm" title="Permalink to this heading">#</a></h3>
<p>The primary objective of MMM is to decode the contribution of different marketing channels to sales and understand how these channels interact with one another. This involves dissecting the marketing budget to identify the most and least efficient areas of spending. By modeling the relationship between marketing spend and business outcomes, MMM allows for the simulation of different scenarios to forecast future performance. This forward-looking approach aids in budget optimization and strategic planning, enabling marketers to adjust their strategies in anticipation of changing market dynamics and consumer behaviors.</p>
<p>Ultimately, MMM serves as a guiding light for marketers, navigating them through the intricacies of planning and optimization in a multi-channel landscape. It stands as a testament to the power of data-driven decision-making, underscoring the shift from intuition-based to evidence-based marketing strategies. As we dive deeper into the nuances of MMM, we will explore its framework, provide a step-by-step guide on building a model using Python, and demonstrate how these insights can be leveraged to achieve marketing excellence.</p>
</section>
</section>
<section id="the-basics-of-media-mix-modeling">
<h2>9.2 <strong>The Basics of Media Mix Modeling</strong><a class="headerlink" href="#the-basics-of-media-mix-modeling" title="Permalink to this heading">#</a></h2>
<p>In the dynamic world of marketing, understanding and optimizing the impact of various advertising efforts on sales and brand recognition is an ongoing challenge. Media Mix Modeling (MMM) emerges as a powerful tool for marketers aiming to decode the efficacy of each dollar spent across marketing channels. MMM is a statistical approach that quantifies the relationship between marketing inputs and their outcomes, usually sales or brand awareness, allowing marketers to forecast the impact of future marketing strategies.</p>
<section id="what-is-media-mix-modeling">
<h3>9.2.1 What is Media Mix Modeling?<a class="headerlink" href="#what-is-media-mix-modeling" title="Permalink to this heading">#</a></h3>
<p>Fundamentally, MMM utilizes regression analysis to gauge the additional effects of diverse marketing initiatives on sales or other critical performance metrics. Through the examination of past data, MMM offers perspectives on the contribution of various components of the marketing mix, such as TV and digital advertising, promotions, and pricing strategies, to the overall effectiveness. This analysis helps marketers understand the effectiveness of each channel and optimize their budgets accordingly.</p>
</section>
<section id="the-role-of-mmm-in-data-driven-marketing-decisions">
<h3>9.2.2 The Role of MMM in Data-Driven Marketing Decisions<a class="headerlink" href="#the-role-of-mmm-in-data-driven-marketing-decisions" title="Permalink to this heading">#</a></h3>
<p>In an era where data plays a crucial role, MMM stands out as a critical tool in the marketer’s arsenal. It provides a comprehensive view of marketing effectiveness, capturing the synergies and dynamics between different media channels. By incorporating external factors such as economic conditions, competitor actions, and seasonal trends, MMM offers a nuanced understanding of marketing performance. This holistic approach enables marketers to make informed decisions, allocate resources efficiently, and maximize return on investment (ROI).</p>
</section>
<section id="key-components-of-mmm">
<h3>9.2.3 Key Components of MMM<a class="headerlink" href="#key-components-of-mmm" title="Permalink to this heading">#</a></h3>
<p>Understanding the components that MMM analyzes is essential to grasp its functionality and utility:</p>
<ul class="simple">
<li><p><strong>Media Channels</strong>: MMM evaluates both traditional (e.g., TV, radio, print) and digital (e.g., social media, search engine marketing, email) advertising channels.</p></li>
<li><p><strong>External Factors</strong>: These include any variables that might impact sales or marketing effectiveness outside of the company’s control, such as economic indicators, weather conditions, and competitive marketing activities.</p></li>
<li><p><strong>Baseline Sales</strong>: This refers to the sales level that would be expected without any marketing activities. Understanding the baseline allows for the measurement of the incremental impact of marketing efforts.</p></li>
</ul>
</section>
<section id="brief-history-and-evolution-of-mmm">
<h3>9.2.4 Brief History and Evolution of MMM<a class="headerlink" href="#brief-history-and-evolution-of-mmm" title="Permalink to this heading">#</a></h3>
<p>The roots of MMM trace back to the early days of econometric modeling in the 1960s, but it was the advent of more sophisticated computing power and data collection methods in the late 20th century that truly unlocked its potential. Originally focused on traditional media channels, the rise of digital marketing has significantly expanded MMM’s scope. Today, MMM must navigate a far more complex media landscape, integrating a multitude of digital data sources while addressing challenges like consumer privacy concerns and the diminishing effectiveness of cookies.</p>
<p>In conclusion, Media Mix Modeling is an indispensable tool for marketers seeking to navigate the complexities of the modern advertising landscape. By offering a detailed analysis of how various marketing channels and external factors impact sales, MMM empowers businesses to optimize their marketing spend, enhance their strategic planning, and ultimately drive greater ROI. As we delve deeper into this topic, we’ll explore the theoretical underpinnings of MMM and how it integrates with broader marketing and econometric theories to provide actionable insights.</p>
</section>
</section>
<section id="understanding-the-framework-of-mmm">
<h2>9.3 <strong>Understanding the Framework of MMM</strong><a class="headerlink" href="#understanding-the-framework-of-mmm" title="Permalink to this heading">#</a></h2>
<p>Media Mix Modeling (MMM) operates at the intersection of marketing science and statistical analysis, offering a framework that quantifies the impact of marketing strategies on business outcomes. This section explores the theoretical foundations of MMM, its statistical underpinnings, and how it accounts for the complex interplay between various media channels and external factors.</p>
<section id="theoretical-foundation-of-mmm">
<h3>9.3.1 Theoretical Foundation of MMM<a class="headerlink" href="#theoretical-foundation-of-mmm" title="Permalink to this heading">#</a></h3>
<p>The theoretical underpinning of MMM is rooted in econometrics, a branch of economics that applies statistical methods to economic data to provide empirical content to economic relationships. MMM applies these principles to marketing, aiming to understand and quantify the relationships between marketing inputs (expenditures across various channels) and outputs (sales, brand awareness).</p>
<p>MMM is grounded in the theory of diminishing returns, a fundamental concept in economics that suggests that as investment in a particular area increases, the marginal gains from that investment will eventually decrease. In marketing, this implies that while initially, investments in a marketing channel might yield significant returns, over time, the effectiveness of additional spending will start to diminish.</p>
</section>
<section id="statistical-methods-used-in-mmm">
<h3>9.3.2 Statistical Methods Used in MMM<a class="headerlink" href="#statistical-methods-used-in-mmm" title="Permalink to this heading">#</a></h3>
<p>MMM primarily relies on regression analysis, a statistical technique for estimating the relationships among variables. The general idea is to use historical data to estimate how changes in the marketing mix and external factors affect sales or other dependent variables. The model might take a simple linear form or a more complex one, incorporating interactions between variables to reflect the synergistic effects between different marketing channels.</p>
<ul class="simple">
<li><p><strong>Linear Regression</strong>: The most basic form of MMM, where sales are predicted as a function of marketing spend in different channels. It assumes a direct, linear relationship between marketing spend and sales.</p></li>
<li><p><strong>Multiple Regression</strong>: To capture the influence of multiple factors, MMM often uses multiple regression, which can account for various marketing channels and external factors simultaneously.</p></li>
<li><p><strong>Bayesian Methods and Time Series Analysis</strong>: For more sophisticated MMMs, Bayesian methods can incorporate prior knowledge into the analysis, and time series analysis can account for the temporal dynamics and lag effects of marketing efforts.</p></li>
</ul>
</section>
<section id="accounting-for-diminishing-returns-and-synergy">
<h3>9.3.3 Accounting for Diminishing Returns and Synergy<a class="headerlink" href="#accounting-for-diminishing-returns-and-synergy" title="Permalink to this heading">#</a></h3>
<p>A critical aspect of MMM is its ability to account for diminishing returns and the synergistic effects between different marketing channels. Diminishing returns are modeled through nonlinear functions or interaction terms that show how the impact of additional spending decreases over time. For synergy, MMM includes interaction terms between different media investments to capture how the combination of two or more channels can have a greater impact than the sum of their individual effects.</p>
<ul class="simple">
<li><p><strong>Diminishing Returns</strong>: Represented by a logarithmic function or a polynomial where, after a certain point, increases in advertising spend yield progressively smaller increases in sales.</p></li>
<li><p><strong>Synergy</strong>: Interaction terms in the regression model represent synergy. For example, an interaction term between online and TV advertising might show that the combined effect of these channels is greater than the sum of their separate impacts.</p></li>
</ul>
<p>By integrating these complex relationships, MMM provides a nuanced understanding of marketing effectiveness. This analytical framework helps marketers navigate the multifaceted media landscape, making informed decisions about where to allocate their budgets for maximum impact. In the next section, we’ll explore how to translate these theoretical and statistical considerations into practice by building a Media Mix Model in Python, step by step.</p>
</section>
</section>
<section id="building-a-media-mix-model-in-python-a-step-by-step-guide">
<h2>9.4 Building a Media Mix Model in Python: A Step-by-Step Guide<a class="headerlink" href="#building-a-media-mix-model-in-python-a-step-by-step-guide" title="Permalink to this heading">#</a></h2>
<p>In this section, we will walk through the process of building a basic Media Mix Model (MMM) using Python, leveraging the dataset provided in Meta’s Robyn R package. This dataset provides a simple yet illustrative example of how media expenditures across five different media channels (TV, OOH, print, facebook, and search) impact revenue.</p>
<section id="data-description">
<h3>9.4.1 Data Description<a class="headerlink" href="#data-description" title="Permalink to this heading">#</a></h3>
<p>The dataset we will be working with is the one used by Meta’s Robyn package. It comprises weekly media expenditures and revenue data spanning from November 23, 2015, to November 11, 2019, encompassing a total of 208 weeks. The variables included in the dataset are as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">date</span></code>: The beginning date of each week</p>
<p><code class="docutils literal notranslate"><span class="pre">revenue</span></code>: The business revenue generated during the week</p>
<p><code class="docutils literal notranslate"><span class="pre">tv_s</span></code>: Television advertising expenditure for the week</p>
<p><code class="docutils literal notranslate"><span class="pre">ooh_s</span></code>: Out-of-home (OOH) channel expenditure for the week</p>
<p><code class="docutils literal notranslate"><span class="pre">print_s</span></code>: Print media advertising expenditure for the week</p>
<p><code class="docutils literal notranslate"><span class="pre">facebook_i</span></code>: Facebook impressions count</p>
<p><code class="docutils literal notranslate"><span class="pre">search_clicks_p</span></code>: Number of clicks through search results</p>
<p><code class="docutils literal notranslate"><span class="pre">search_s</span></code>: Expenditure on paid search advertising</p>
<p><code class="docutils literal notranslate"><span class="pre">competitor_sales_b</span></code>: Competitor’s sales figures</p>
<p><code class="docutils literal notranslate"><span class="pre">facebook_s</span></code>: Facebook advertising expenditure</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;marketing-analytics-with-python&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># compress the warning messages</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Load the dataset</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;data/Chapter9_mmm.csv&quot;</span><span class="p">)</span>
<span class="c1"># trim the column names </span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c1"># convert date column to datetime format</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(208, 10)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>revenue</th>
      <th>tv_s</th>
      <th>ooh_s</th>
      <th>print_s</th>
      <th>facebook_i</th>
      <th>search_clicks_p</th>
      <th>search_s</th>
      <th>competitor_sales_b</th>
      <th>facebook_s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-11-23</td>
      <td>2.754372e+06</td>
      <td>167687.6</td>
      <td>0</td>
      <td>95463.666667</td>
      <td>7.290385e+07</td>
      <td>0.000000</td>
      <td>0</td>
      <td>8125009</td>
      <td>228213.987444</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-11-30</td>
      <td>2.584277e+06</td>
      <td>214600.9</td>
      <td>0</td>
      <td>0.000000</td>
      <td>1.658110e+07</td>
      <td>29511.715457</td>
      <td>31000</td>
      <td>7901549</td>
      <td>34258.573511</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-12-07</td>
      <td>2.547387e+06</td>
      <td>0.0</td>
      <td>248022</td>
      <td>3404.000000</td>
      <td>4.995477e+07</td>
      <td>36132.358958</td>
      <td>28400</td>
      <td>8300197</td>
      <td>127691.261335</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-12-14</td>
      <td>2.875220e+06</td>
      <td>625877.3</td>
      <td>0</td>
      <td>132600.000000</td>
      <td>3.164930e+07</td>
      <td>36804.210958</td>
      <td>31900</td>
      <td>8122883</td>
      <td>84014.720306</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-12-21</td>
      <td>2.215953e+06</td>
      <td>0.0</td>
      <td>520005</td>
      <td>0.000000</td>
      <td>8.802269e+06</td>
      <td>28401.744069</td>
      <td>27100</td>
      <td>7105985</td>
      <td>20687.478156</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="data-processing">
<h3>9.4.2 Data Processing<a class="headerlink" href="#data-processing" title="Permalink to this heading">#</a></h3>
<p>The purpose of this exercise is to analyze how advertising expenditures by media channels affect business sales revenue. We will include only the media expenditure data, the target feature ‘revenue’, and the ‘date’ column.</p>
<p>Before we prepare the data for model training, we use package ‘sweetviz’ to run an automated EDA analysis. From the generated <a class="reference download internal" download="" href="_downloads/9eb6cdf3e54f419460c111d9d5fe2372/results%5CChapter9_eda_report.html"><span class="xref download myst">EDA report</span></a>, we can see that this dataset has no missing values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;facebook_i&#39;</span><span class="p">,</span> <span class="s1">&#39;search_clicks_p&#39;</span><span class="p">,</span> <span class="s1">&#39;competitor_sales_b&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sweetviz</span> <span class="k">as</span> <span class="nn">sv</span>

<span class="c1"># Create a report based on the data</span>
<span class="n">report</span> <span class="o">=</span> <span class="n">sv</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Save the report to an HTML file</span>
<span class="n">report</span><span class="o">.</span><span class="n">show_html</span><span class="p">(</span><span class="s1">&#39;results\Chapter9_eda_report.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-engineering">
<h3>9.4.3 Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this heading">#</a></h3>
<p>As we discussed earlier, we need to consider the lagged effects of media advertising expenditures and the interaction effects across media channels.</p>
<ol class="arabic simple">
<li><p><strong>The adstock effect</strong> is often used to account for the carryover effects of advertising on sales. In MMM, the adstock effect is typically captured by including a lagged advertising variable in the model. This lagged advertising variable represents the impact of advertising on future sales, allowing marketers to capture the cumulative impact of advertising over time rather than just the immediate impact of an ad.</p></li>
</ol>
<p>The formula for calculating adstock effect is typically expressed as:
$<span class="math notranslate nohighlight">\(
A_t = X_{t} + \text{adstock\_rate} * A_{t-1}
\)</span>$
Where:</p>
<p><span class="math notranslate nohighlight">\(A_{t}\)</span> represents the adstock at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(X_{t}\)</span> is the advertising expenditure at time <span class="math notranslate nohighlight">\(t\)</span></p>
<p><span class="math notranslate nohighlight">\(\text{adstock\_rate}\)</span> is the percentage of the effect that remains at each time period after the initial advertisement.</p>
<p>We develop a Python function ‘apply_adstock’ as below based on the formula and apply it to transform the media spend features with the adstock effects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function to apply adstock (decay) effect</span>
<span class="k">def</span> <span class="nf">apply_adstock</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">adstocked_x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">previous</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">adstocked_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">previous</span> <span class="o">*</span> <span class="n">decay_rate</span><span class="p">)</span>
        <span class="n">adstocked_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adstocked_value</span><span class="p">)</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">adstocked_value</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">adstocked_x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># adstocking the media spend</span>
<span class="n">media_spend_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tv_s&#39;</span><span class="p">,</span> <span class="s1">&#39;ooh_s&#39;</span><span class="p">,</span> <span class="s1">&#39;print_s&#39;</span><span class="p">,</span> <span class="s1">&#39;search_s&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook_s&#39;</span><span class="p">]</span>

<span class="n">df_adstock</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">for</span> <span class="n">media</span> <span class="ow">in</span> <span class="n">media_spend_list</span><span class="p">:</span>
    <span class="n">df_adstock</span><span class="p">[</span><span class="n">media</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_adstock</span><span class="p">(</span><span class="n">df_adstock</span><span class="p">[</span><span class="n">media</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>I need to call out that as we transform the media spend features with adstock effects, the first several rows of the post-transformation do not include the adstock effects
of the previous weeks as they are not available from the dataset. Thus, we need to exclude those rows from the training dataset. The number of weeks to exclude is determined
by the decay rate and the threshold level that we can consider the adstock effects as ignorable on each of the remaining periods. As the general form of the exponential decay
formula is
$<span class="math notranslate nohighlight">\(
V_t = V_0 \times {(\text{decay}\ \text{rate})}^t
\)</span>$</p>
<p>where:</p>
<p><span class="math notranslate nohighlight">\(V_t\)</span> is the value at time,</p>
<p><span class="math notranslate nohighlight">\(V_0\)</span> is the initial value,</p>
<p><span class="math notranslate nohighlight">\(\text{decay}\ \text{rate}\)</span> is the rate at which the value decays per time period, and</p>
<p><span class="math notranslate nohighlight">\(t\)</span> is the number of time periods.</p>
<p>After n time periods, <span class="math notranslate nohighlight">\(V_t = b \times V_0\)</span> where b is the threshold level. Thus, we can have the formula to calculate <span class="math notranslate nohighlight">\(n\)</span> as below:
$<span class="math notranslate nohighlight">\(
n = \frac{\ln(b)}{\ln(\text{decay}\ \text{rate})}
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="n">decay_rate</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># Example decay rate</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.10</span>  <span class="c1"># 5% threshold</span>

<span class="n">t</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">decay_rate</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<p>If we consider decay rate = 0.5 and the threshold level = 0.20, the need to exclude the first two rows of dataset to remove the data noise from the data transformation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exclude the first t rows</span>
<span class="n">df_adstock</span> <span class="o">=</span> <span class="n">df_adstock</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">t</span><span class="p">:]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_adstock</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(205, 7)
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p><strong>Interaction Terms</strong> can be captured by multiplication of terms or polynomial features. In our use case, we will use the multiplication of two media spend features.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># add interaction terms of medias in media_spend_list</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">media1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">media_spend_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">media2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">media_spend_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">df_adstock</span><span class="p">[</span><span class="n">media1</span> <span class="o">+</span> <span class="s1">&#39;_x_&#39;</span> <span class="o">+</span> <span class="n">media2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_adstock</span><span class="p">[</span><span class="n">media1</span><span class="p">]</span> <span class="o">*</span> <span class="n">df_adstock</span><span class="p">[</span><span class="n">media2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p><strong>Time-related features</strong>: Based on the ‘date’ column, we can create a feature ‘month’ to capture the seasonality.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create month feature from &#39;date&#39;</span>
<span class="n">df_adstock</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_adstock</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="c1"># create dummy variables for &#39;month&#39;</span>
<span class="n">df_adstock</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df_adstock</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_adstock</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>revenue</th>
      <th>tv_s</th>
      <th>ooh_s</th>
      <th>print_s</th>
      <th>search_s</th>
      <th>facebook_s</th>
      <th>tv_s_x_ooh_s</th>
      <th>tv_s_x_print_s</th>
      <th>tv_s_x_search_s</th>
      <th>...</th>
      <th>month_3</th>
      <th>month_4</th>
      <th>month_5</th>
      <th>month_6</th>
      <th>month_7</th>
      <th>month_8</th>
      <th>month_9</th>
      <th>month_10</th>
      <th>month_11</th>
      <th>month_12</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>2015-12-14</td>
      <td>2.875220e+06</td>
      <td>700488.475000</td>
      <td>124011.0000</td>
      <td>146234.958333</td>
      <td>53850.000</td>
      <td>184951.742781</td>
      <td>8.686828e+10</td>
      <td>1.024359e+11</td>
      <td>3.772130e+10</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-12-21</td>
      <td>2.215953e+06</td>
      <td>350244.237500</td>
      <td>582010.5000</td>
      <td>73117.479167</td>
      <td>54025.000</td>
      <td>113163.349546</td>
      <td>2.038458e+11</td>
      <td>2.560898e+10</td>
      <td>1.892194e+10</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2015-12-28</td>
      <td>2.569922e+06</td>
      <td>424311.918750</td>
      <td>291005.2500</td>
      <td>275976.072917</td>
      <td>55312.500</td>
      <td>216691.829975</td>
      <td>1.234770e+11</td>
      <td>1.170999e+11</td>
      <td>2.346975e+10</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>True</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2016-01-04</td>
      <td>2.171507e+06</td>
      <td>217308.859375</td>
      <td>570665.6250</td>
      <td>137988.036458</td>
      <td>55456.250</td>
      <td>217036.281974</td>
      <td>1.240107e+11</td>
      <td>2.998602e+10</td>
      <td>1.205113e+10</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2016-01-11</td>
      <td>2.464132e+06</td>
      <td>130796.129687</td>
      <td>285332.8125</td>
      <td>245853.684896</td>
      <td>59728.125</td>
      <td>232412.625582</td>
      <td>3.732043e+10</td>
      <td>3.215671e+10</td>
      <td>7.812208e+09</td>
      <td>...</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 28 columns</p>
</div></div></div>
</div>
</section>
<section id="model-training">
<h3>9.4.4 Model Training<a class="headerlink" href="#model-training" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Predictor variables with adstock and interaction terms</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df_adstock</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;revenue&#39;</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_adstock</span><span class="p">[</span><span class="s1">&#39;revenue&#39;</span><span class="p">]</span>  <span class="c1"># Response variable</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># build more complex models</span>
<span class="kn">import</span> <span class="nn">xgboost</span>
 
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">AdaBoostRegressor</span>
<span class="kn">from</span> <span class="nn">xgboost.sklearn</span> <span class="kn">import</span> <span class="n">XGBRegressor</span> 
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">neighbors</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">ada</span> <span class="o">=</span> <span class="n">AdaBoostRegressor</span><span class="p">()</span>
<span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">()</span>
<span class="n">rfr</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">()</span>
<span class="n">dtr</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">()</span>
<span class="n">gbr</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">()</span>
<span class="n">knn</span> <span class="o">=</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">()</span> 
<span class="n">lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;LinearRegression&quot;</span><span class="p">,</span> <span class="s2">&quot;AdaBoostRegressor&quot;</span><span class="p">,</span><span class="s2">&quot;XGBRegressor&quot;</span><span class="p">,</span><span class="s2">&quot;RandomForestRegressor&quot;</span><span class="p">,</span><span class="s2">&quot;DecisionTreeRegressor&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GradientBoostingRegressor&quot;</span><span class="p">,</span><span class="s2">&quot;KNeighborsRegressor&quot;</span><span class="p">]</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="n">lr</span><span class="p">,</span> <span class="n">ada</span><span class="p">,</span> <span class="n">xgb</span><span class="p">,</span> <span class="n">rfr</span><span class="p">,</span> <span class="n">dtr</span><span class="p">,</span> <span class="n">gbr</span><span class="p">,</span> <span class="n">knn</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    
    <span class="c1"># Predict the test data</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="c1"># Calculate the R-squared, MAE, and RMSE</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">models</span><span class="p">):</span>
    <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;LinearRegression&#39;, LinearRegression(), 0.766, 229173.994, 303033.456)
</pre></div>
</div>
</div>
</div>
</section>
<section id="search-for-the-best-model">
<h3>9.4.5 search for the best model<a class="headerlink" href="#search-for-the-best-model" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="k">def</span> <span class="nf">apply_adstock</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">adstocked_x</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">previous</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">adstocked_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">+</span> <span class="p">(</span><span class="n">previous</span> <span class="o">*</span> <span class="n">decay_rate</span><span class="p">)</span>
        <span class="n">adstocked_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adstocked_value</span><span class="p">)</span>
        <span class="n">previous</span> <span class="o">=</span> <span class="n">adstocked_value</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">adstocked_x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">apply_synergy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">media_spend_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tv_s&#39;</span><span class="p">,</span> <span class="s1">&#39;ooh_s&#39;</span><span class="p">,</span> <span class="s1">&#39;print_s&#39;</span><span class="p">,</span> <span class="s1">&#39;search_s&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook_s&#39;</span><span class="p">]):</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
    <span class="c1"># add interaction terms of medias in media_spend_list</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">media1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">media_spend_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">media2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">media_spend_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="n">media1</span> <span class="o">+</span> <span class="s1">&#39;_x_&#39;</span> <span class="o">+</span> <span class="n">media2</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">media1</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">media2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span> 

<span class="k">def</span> <span class="nf">trim_threshold</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">decay_rate</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">t</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">add_ts_features</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># drop date column</span>
    <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">train_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;revenue&#39;</span><span class="p">,</span><span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">target</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>  <span class="c1"># Response variable</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="c1"># Adds a constant term to the predictor             </span>
                
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span>

<span class="k">def</span> <span class="nf">data_pipe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">media_spend_list</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tv_s&#39;</span><span class="p">,</span> <span class="s1">&#39;ooh_s&#39;</span><span class="p">,</span> <span class="s1">&#39;print_s&#39;</span><span class="p">,</span> <span class="s1">&#39;search_s&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook_s&#39;</span><span class="p">],</span> <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;revenue&#39;</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span> 
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">media</span> <span class="ow">in</span> <span class="n">media_spend_list</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">media</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_adstock</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">media</span><span class="p">],</span> <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">)</span> 
    <span class="n">df</span> <span class="o">=</span> <span class="n">apply_synergy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">media_spend_list</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">add_ts_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">trim_threshold</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span><span class="n">train_size</span><span class="o">=</span><span class="n">train_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span>    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">data_pipe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">media_spend_list</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tv_s&#39;</span><span class="p">,</span> <span class="s1">&#39;ooh_s&#39;</span><span class="p">,</span> <span class="s1">&#39;print_s&#39;</span><span class="p">,</span> <span class="s1">&#39;search_s&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook_s&#39;</span><span class="p">],</span> <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;revenue&#39;</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">decay_rates</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.05</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">decay_rate</span> <span class="ow">in</span> <span class="n">decay_rates</span><span class="p">:</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">data_pipe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">media_spend_list</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tv_s&#39;</span><span class="p">,</span> <span class="s1">&#39;ooh_s&#39;</span><span class="p">,</span> <span class="s1">&#39;print_s&#39;</span><span class="p">,</span> <span class="s1">&#39;search_s&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook_s&#39;</span><span class="p">],</span> <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;revenue&#39;</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">models</span><span class="p">):</span>
        <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">decay_rate</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.05, &#39;LinearRegression&#39;, LinearRegression(), 0.785, 209114.346, 289760.622)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get all R-squared from results</span>
<span class="n">r2_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
<span class="c1"># model with the highest R-squared</span>
<span class="n">best_model_index</span> <span class="o">=</span> <span class="n">r2_scores</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">r2_scores</span><span class="p">))</span>
<span class="c1"># get the best model in terms of R-Square</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">best_model_index</span><span class="p">]</span>
<span class="n">best_model_decay_rate</span> <span class="o">=</span> <span class="n">best_model</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">best_model_name</span> <span class="o">=</span> <span class="n">best_model</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">best_model_r2_score</span> <span class="o">=</span> <span class="n">best_model</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">best_model_trained</span> <span class="o">=</span> <span class="n">best_model</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Decay Rate for the best model:&quot;</span><span class="p">,</span> <span class="n">best_model_decay_rate</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name of the best model:&quot;</span><span class="p">,</span> <span class="n">best_model_name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;R2-Score of the best model:&quot;</span><span class="p">,</span> <span class="n">best_model_r2_score</span><span class="p">)</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Decay Rate for the best model: 0.9
Name of the best model: LinearRegression
R2-Score of the best model: 0.876
</pre></div>
</div>
</div>
</div>
</section>
<section id="media-expenditure-optimization">
<h3>9.4.6 Media Expenditure Optimization<a class="headerlink" href="#media-expenditure-optimization" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">spend</span><span class="p">,</span> <span class="n">base_data</span><span class="o">=</span><span class="n">X</span><span class="p">,</span>  <span class="n">model</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">media_spend_list</span><span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tv_s&#39;</span><span class="p">,</span> <span class="s1">&#39;ooh_s&#39;</span><span class="p">,</span> <span class="s1">&#39;print_s&#39;</span><span class="p">,</span> <span class="s1">&#39;search_s&#39;</span><span class="p">,</span> <span class="s1">&#39;facebook_s&#39;</span><span class="p">],</span> <span class="n">decay_rate</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Objective function to be minimized.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - spend: Array of spend by media channel.</span>
<span class="sd">    - model: Trained GAM model.</span>
<span class="sd">    - base_data: DataFrame containing base values for all features except media spends.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    - Negative predicted revenue to be minimized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Copy base_data to avoid modifying the original</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">base_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">media</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">media_spend_list</span><span class="p">):</span>
        <span class="n">df</span><span class="p">[</span><span class="n">media</span><span class="p">]</span> <span class="o">=</span> <span class="n">spend</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">df</span><span class="p">[</span><span class="n">media</span><span class="p">]</span> <span class="o">=</span> <span class="n">apply_adstock</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">media</span><span class="p">],</span> <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">)</span> 
    <span class="n">df</span> <span class="o">=</span> <span class="n">apply_synergy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">media_spend_list</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">add_ts_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">trim_threshold</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">decay_rate</span><span class="o">=</span><span class="n">decay_rate</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
    
    <span class="c1"># Predict revenue with the updated media spends</span>
    <span class="n">predicted_revenue</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># Return negative revenue because we are minimizing</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">predicted_revenue</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>revenue</th>
      <th>tv_s</th>
      <th>ooh_s</th>
      <th>print_s</th>
      <th>search_s</th>
      <th>facebook_s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2015-11-23</td>
      <td>2.754372e+06</td>
      <td>167687.6</td>
      <td>0</td>
      <td>95463.666667</td>
      <td>0</td>
      <td>228213.987444</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-11-30</td>
      <td>2.584277e+06</td>
      <td>214600.9</td>
      <td>0</td>
      <td>0.000000</td>
      <td>31000</td>
      <td>34258.573511</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2015-12-07</td>
      <td>2.547387e+06</td>
      <td>0.0</td>
      <td>248022</td>
      <td>3404.000000</td>
      <td>28400</td>
      <td>127691.261335</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-12-14</td>
      <td>2.875220e+06</td>
      <td>625877.3</td>
      <td>0</td>
      <td>132600.000000</td>
      <td>31900</td>
      <td>84014.720306</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2015-12-21</td>
      <td>2.215953e+06</td>
      <td>0.0</td>
      <td>520005</td>
      <td>0.000000</td>
      <td>27100</td>
      <td>20687.478156</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spend</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">media_spend_list</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">spend</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tv_s</th>
      <th>ooh_s</th>
      <th>print_s</th>
      <th>search_s</th>
      <th>facebook_s</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>167687.6</td>
      <td>0</td>
      <td>95463.666667</td>
      <td>0</td>
      <td>228213.987444</td>
    </tr>
    <tr>
      <th>1</th>
      <td>214600.9</td>
      <td>0</td>
      <td>0.000000</td>
      <td>31000</td>
      <td>34258.573511</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>248022</td>
      <td>3404.000000</td>
      <td>28400</td>
      <td>127691.261335</td>
    </tr>
    <tr>
      <th>3</th>
      <td>625877.3</td>
      <td>0</td>
      <td>132600.000000</td>
      <td>31900</td>
      <td>84014.720306</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>520005</td>
      <td>0.000000</td>
      <td>27100</td>
      <td>20687.478156</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>

<span class="c1"># Total budget constraint</span>
<span class="n">total_budget</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">media_spend_list</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="c1"># Example total budget</span>

<span class="c1"># Constraints function ensuring the sum of spends equals the total budget</span>
<span class="n">constraints</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">spend</span><span class="p">:</span> <span class="n">total_budget</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">(</span><span class="n">spend</span><span class="p">)})</span>

<span class="c1"># Bounds for each channel (e.g., min and max spend for each)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_budget</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">media_spend_list</span><span class="p">]</span>  <span class="c1"># Example bounds</span>

<span class="n">decay_rate</span> <span class="o">=</span> <span class="n">best_model_decay_rate</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">t</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">decay_rate</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial guess (e.g., evenly distribute the total budget across channels)</span>
<span class="n">initial_guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">total_budget</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">media_spend_list</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">media_spend_list</span><span class="p">]</span>

<span class="c1"># Run the optimization</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">objective</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">)</span>

<span class="c1"># Check the optimal spends found</span>
<span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
    <span class="n">optimal_spends</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimal spends by media channel:&quot;</span><span class="p">,</span> <span class="n">optimal_spends</span><span class="p">)</span>
    <span class="c1"># Calculate the predicted revenue with the optimal spends</span>
    <span class="n">optimal_revenue</span> <span class="o">=</span> <span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">fun</span>
    <span class="c1"># Print the predicted revenue with the optimal spends</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted revenue with optimal media spend:, </span><span class="si">{</span><span class="n">optimal_revenue</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># print the original media spend</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original media spend: spend.sum().values[0]&quot;</span><span class="p">)</span>
    <span class="c1"># print the predicted revenue with the original media spend</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Predicted revenue with original media spend: </span><span class="si">{</span><span class="n">objective</span><span class="p">(</span><span class="n">spend</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># print the actual revenue with the original media spend</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Actual revenue with original media spend: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;revenue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># print the difference between the original and optimal revenue</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Revenue difference:&quot;</span><span class="p">,</span> <span class="n">optimal_revenue</span> <span class="o">-</span> <span class="n">objective</span><span class="p">(</span><span class="n">spend</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimization was not successful. Reason:&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chapter_8.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 8 Marketing Channel Attribution Models</p>
      </div>
    </a>
    <a class="right-next"
       href="chapter_10.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 10 Next Best Action (NBA) Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">9.1 <strong>Introduction</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-importance-of-mmm-in-the-modern-marketing-landscape">9.1.1 The Importance of MMM in the Modern Marketing Landscape</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-objective-of-mmm">9.1.2 The Objective of MMM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-basics-of-media-mix-modeling">9.2 <strong>The Basics of Media Mix Modeling</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-is-media-mix-modeling">9.2.1 What is Media Mix Modeling?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-role-of-mmm-in-data-driven-marketing-decisions">9.2.2 The Role of MMM in Data-Driven Marketing Decisions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-components-of-mmm">9.2.3 Key Components of MMM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#brief-history-and-evolution-of-mmm">9.2.4 Brief History and Evolution of MMM</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#understanding-the-framework-of-mmm">9.3 <strong>Understanding the Framework of MMM</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#theoretical-foundation-of-mmm">9.3.1 Theoretical Foundation of MMM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-methods-used-in-mmm">9.3.2 Statistical Methods Used in MMM</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#accounting-for-diminishing-returns-and-synergy">9.3.3 Accounting for Diminishing Returns and Synergy</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#building-a-media-mix-model-in-python-a-step-by-step-guide">9.4 Building a Media Mix Model in Python: A Step-by-Step Guide</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-description">9.4.1 Data Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-processing">9.4.2 Data Processing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-engineering">9.4.3 Feature Engineering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-training">9.4.4 Model Training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-for-the-best-model">9.4.5 search for the best model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#media-expenditure-optimization">9.4.6 Media Expenditure Optimization</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Phillip Peng
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>